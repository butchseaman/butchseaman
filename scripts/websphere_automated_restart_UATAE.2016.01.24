
#!/bin/bash
#
####### This script is for automated restarts of WebSphere ####### wseaman - 2015.04.06 set -x clear;echo "";echo ""
MAIL_LIST=/home/cpe_os_user/usr/local/bin/email_list.txt
DATE=`date +%Y.%m.%d"_"%H":"%M`
HOSTNAME=`hostname`
LOG=/tmp/websphere_restart.txt
STATUS=$?
USERNAME_REVICN=svc_P8RU_WASAdmin
PASSWORD_REVICN=CmtY32\&D\@L\-\:4\;B
USERNAME_NSMAE=P8TEST_CEDSUser
PASSWORD_NSMAE=j\#239\@\#YHp
USERNAME_NSMICN=P8TEST_CEDSUser
PASSWORD_NSMICN=j\#239\@\#YHp
USERNAME_REVAE=svc_P8RU_CPEDSUser
PASSWORD_REVAE=U\.65\~Y\:\+uhdMtL\!
USERNAME_USAAICN=svc_P8UAT_USAAAdmin
PASSWORD_USAAICN=aarLq8\%\#uQ66s5s7
USERNAME_USAAAE=svc_P8UAT_USAAAdmin
PASSWORD_USAAAE=aarLq8\%\#uQ66s5s7
  #
 #
#
echo "Automated restart log for $HOSTNAME on $DATE" > $LOG echo "" >> $LOG echo "#################################################################################################" >> $LOG echo "" >> $LOG #  #
  #
 #
#
### Stop all profiles
  #
 #
#
####### Stop AppSrv01 / REVERSE_ICN
/opt/IBM/WebSphere/AppServer/profiles/AppSrv01/bin/serverStatus.sh server1 -username $USERNAME_REVICN -password $PASSWORD_REVICN | grep "Started"
if [ $STATUS -eq 0 ] ; then
/opt/IBM/WebSphere/AppServer/profiles/AppSrv01/bin/stopServer.sh server1 -username $USERNAME_REVICN -password $PASSWORD_REVICN #echo " REVERSE_ICN" >> $LOG tail -1 fi
  #
 #
#
####### Stop NSM_AE
/opt/IBM/WebSphere/AppServer/profiles/NSM_AE/bin/serverStatus.sh server1 -username $USERNAME_NSMAE -password $PASSWORD_NSMAE | grep "Started"
if [ $STATUS -eq 0 ] ; then
/opt/IBM/WebSphere/AppServer/profiles/NSM_AE/bin/stopServer.sh server1 -username $USERNAME_NSMAE -password $PASSWORD_NSMAE #echo " NSM_AE" >> $LOG tail -1 fi
  #
 #
#
####### Stop NSM_ICN
/opt/IBM/WebSphere/AppServer/profiles/NSM_ICN/bin/serverStatus.sh server1 -username $USERNAME_NSMICN -password $PASSWORD_NSMICN | grep "Started"
if [ $STATUS -eq 0 ] ; then
/opt/IBM/WebSphere/AppServer/profiles/NSM_ICN/bin/stopServer.sh server1 -username $USERNAME_NSMICN -password $PASSWORD_NSMICN #echo " REVERSE_ICN" >> $LOG tail -1 fi
  #
 #
#
####### Stop REVERSE_AE
/opt/IBM/WebSphere/AppServer/profiles/REVERSE_AE/bin/serverStatus.sh server1 -username $USERNAME_REVAE -password $PASSWORD_REVAE | grep "Started"
if [ $STATUS -eq 0 ] ; then
/opt/IBM/WebSphere/AppServer/profiles/REVERSE_AE/bin/stopServer.sh server1 -username $USERNAME_REVAE -password $PASSWORD_REVAE #echo " REVERSE_AE" >> $LOG tail -1 fi
  #
 #
#
####### Stop USAA_ICN
/opt/IBM/WebSphere/AppServer/profiles/USAA_ICN/bin/serverStatus.sh server1 -username $USERNAME_USAAICN -password $PASSWORD_USAAICN | grep "Started"
if [ $STATUS -eq 0 ] ; then
/opt/IBM/WebSphere/AppServer/profiles/USAA_ICN/bin/stopServer.sh server1 -username $USERNAME_USAAICN -password $PASSWORD_USAAICN #echo " USAA_ICN" >> $LOG tail -1 fi
  #
 #
#
####### Stop USAA_AE
/opt/IBM/WebSphere/AppServer/profiles/USAA_AE/bin/serverStatus.sh server1 -username $USERNAME_USAAICN -password $PASSWORD_USAAICN | grep "Started"
if [ $STATUS -eq 0 ] ; then
/opt/IBM/WebSphere/AppServer/profiles/USAA_AE/bin/stopServer.sh server1 -username $USERNAME_USAAICN -password $PASSWORD_USAAICN #echo " USAA_AE" >> $LOG tail -1 fi #  #
  #
 #
#

####### Sleep for 10 minutes
sleep 10
#
 #
  #
 #
#
### Restart all profiles
  #
 #
#
####### Start AppSrv01 / REVERSE_ICN
/opt/IBM/WebSphere/AppServer/profiles/AppSrv01/bin/serverStatus.sh server1 -username $USERNAME_REVICN -password $PASSWORD_REVICN | grep "Started"
if [ $STATUS -eq 0 ] ; then
/opt/IBM/WebSphere/AppServer/profiles/AppSrv01/bin/stopServer.sh server1 -username $USERNAME_REVICN -password $PASSWORD_REVICN echo " REVERSE_ICN" >> $LOG tail -1 sleep 30 /opt/IBM/WebSphere/AppServer/profiles/AppSrv01/bin/startServer.sh server1 sleep 10 cat /opt/IBM/WebSphere/AppServer/profiles/AppSrv01/logs/server1/SystemOut.log | grep WsServerImpl | tail -1 >> $LOG echo " REVERSE_ICN" >> $LOG tail -1 else /opt/IBM/WebSphere/AppServer/profiles/AppSrv01/bin/startServer.sh server1 sleep 10 echo " REVERSE_ICN" >> $LOG tail -1 /opt/IBM/WebSphere/AppServer/profiles/AppSrv01/logs/server1/SystemOut.log >> $LOG fi echo "" >> $LOG echo "#################################################################################################" >> $LOG echo "" >> $LOG
  #
 #
#
####### Start NSM_AE
/opt/IBM/WebSphere/AppServer/profiles/NSM_AE/bin/serverStatus.sh server1 -username $USERNAME_NSMAE -password $PASSWORD_NSMAE | grep "Started"
if [ $STATUS -eq 0 ] ; then
/opt/IBM/WebSphere/AppServer/profiles/NSM_AE/bin/stopServer.sh server1 -username $USERNAME_NSMAE -password $PASSWORD_NSMAE echo " NSM_AE" >> $LOG tail -1 sleep 10 /opt/IBM/WebSphere/AppServer/profiles/NSM_AE/bin/startServer.sh server1 sleep 10 cat /opt/IBM/WebSphere/AppServer/profiles/NSM_AE/logs/server1/SystemOut.log | grep WsServerImpl | tail -1 >> $LOG echo " NSM_AE" >> $LOG tail -1 else /opt/IBM/WebSphere/AppServer/profiles/NSM_AE/bin/startServer.sh server1 sleep 10 echo " NSM_AE" >> $LOG tail -1 /opt/IBM/WebSphere/AppServer/profiles/NSM_AE/logs/server1/SystemOut.log >> $LOG fi echo "" >> $LOG echo "#################################################################################################" >> $LOG echo "" >> $LOG
  #
 #
#
####### Start NSM_ICN
/opt/IBM/WebSphere/AppServer/profiles/NSM_ICN/bin/serverStatus.sh server1 -username $USERNAME_NSMICN -password $PASSWORD_NSMICN | grep "Started"
if [ $STATUS -eq 0 ] ; then
/opt/IBM/WebSphere/AppServer/profiles/NSM_ICN/bin/stopServer.sh server1 -username $USERNAME_NSMICN -password $PASSWORD_NSMICN echo " REVERSE_ICN" >> $LOG tail -1 sleep 10 /opt/IBM/WebSphere/AppServer/profiles/NSM_ICN/bin/startServer.sh server1 sleep 10 cat /opt/IBM/WebSphere/AppServer/profiles/NSM_ICN/logs/server1/SystemOut.log | grep WsServerImpl | tail -1 >> $LOG echo " REVERSE_ICN" >> $LOG tail -1 else /opt/IBM/WebSphere/AppServer/profiles/NSM_ICN/bin/startServer.sh server1 sleep 10 echo " REVERSE_ICN" >> $LOG tail -1 /opt/IBM/WebSphere/AppServer/profiles/NSM_ICN/logs/server1/SystemOut.log >> $LOG fi echo "" >> $LOG echo "#################################################################################################" >> $LOG echo "" >> $LOG
  #
 #
#
####### Start REVERSE_AE
/opt/IBM/WebSphere/AppServer/profiles/REVERSE_AE/bin/serverStatus.sh server1 -username $USERNAME_REVAE -password $PASSWORD_REVAE | grep "Started"
if [ $STATUS -eq 0 ] ; then
/opt/IBM/WebSphere/AppServer/profiles/REVERSE_AE/bin/stopServer.sh server1 -username $USERNAME_REVAE -password $PASSWORD_REVAE echo " REVERSE_AE" >> $LOG tail -1 sleep 10 /opt/IBM/WebSphere/AppServer/profiles/REVERSE_AE/bin/startServer.sh server1 sleep 10 cat /opt/IBM/WebSphere/AppServer/profiles/REVERSE_AE/logs/server1/SystemOut.log | grep WsServerImpl | tail -1 >> $LOG echo " REVERSE_AE" >> $LOG tail -1 else /opt/IBM/WebSphere/AppServer/profiles/REVERSE_AE/bin/startServer.sh server1 sleep 10 echo " REVERSE_AE" >> $LOG tail -1 /opt/IBM/WebSphere/AppServer/profiles/REVERSE_AE/logs/server1/SystemOut.log >> $LOG fi echo "" >> $LOG echo "#################################################################################################" >> $LOG echo "" >> $LOG
  #
 #
#
####### Start USAA_ICN
/opt/IBM/WebSphere/AppServer/profiles/USAA_ICN/bin/serverStatus.sh server1 -username $USERNAME_USAAICN -password $PASSWORD_USAAICN | grep "Started"
if [ $STATUS -eq 0 ] ; then
/opt/IBM/WebSphere/AppServer/profiles/USAA_ICN/bin/stopServer.sh server1 -username $USERNAME_USAAICN -password $PASSWORD_USAAICN echo " USAA_ICN" >> $LOG tail -1 sleep 10 /opt/IBM/WebSphere/AppServer/profiles/USAA_ICN/bin/startServer.sh server1 sleep 10 cat /opt/IBM/WebSphere/AppServer/profiles/USAA_ICN/logs/server1/SystemOut.log | grep WsServerImpl | tail -1 >> $LOG echo " USAA_ICN" >> $LOG tail -1 else /opt/IBM/WebSphere/AppServer/profiles/USAA_ICN/bin/startServer.sh server1 sleep 10 echo " USAA_ICN" >> $LOG tail -1 /opt/IBM/WebSphere/AppServer/profiles/USAA_ICN/logs/server1/SystemOut.log >> $LOG fi echo "" >> $LOG echo "#################################################################################################" >> $LOG echo "" >> $LOG
  #
 #
#
####### Start USAA_AE
/opt/IBM/WebSphere/AppServer/profiles/USAA_AE/bin/serverStatus.sh server1 -username $USERNAME_USAAICN -password $PASSWORD_USAAICN | grep "Started"
if [ $STATUS -eq 0 ] ; then
/opt/IBM/WebSphere/AppServer/profiles/USAA_AE/bin/stopServer.sh server1 -username $USERNAME_USAAICN -password $PASSWORD_USAAICN echo " USAA_AE" >> $LOG tail -1 sleep 10 /opt/IBM/WebSphere/AppServer/profiles/USAA_AE/bin/startServer.sh server1 sleep 10 cat /opt/IBM/WebSphere/AppServer/profiles/USAA_AE/logs/server1/SystemOut.log | grep WsServerImpl | tail -1 >> $LOG echo " USAA_AE" >> $LOG tail -1 else /opt/IBM/WebSphere/AppServer/profiles/USAA_AE/bin/startServer.sh server1 sleep 10 echo " USAA_AE" >> $LOG tail -1 /opt/IBM/WebSphere/AppServer/profiles/USAA_AE/logs/server1/SystemOut.log >> $LOG fi echo "" >> $LOG echo "#################################################################################################" >> $LOG echo "" >> $LOG #  #
  #
 #
#
## Email Notification
for NOTIFY in `cat $MAIL_LIST`
do
cat $LOG | mail -s "`hostname` automated restart " $NOTIFY done
